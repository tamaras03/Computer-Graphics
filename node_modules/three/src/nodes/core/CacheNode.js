import Node from './Node.js';
import { addMethodChaining, nodeObject } from '../tsl/TSLCore.js';

<<<<<<< HEAD
=======
/**
 * This node can be used as a cache management component for another node.
 * Caching is in general used by default in {@link NodeBuilder} but this node
 * allows the usage of a shared parent cache during the build process.
 *
 * @augments Node
 */
>>>>>>> 50c6784a0819c7177d83555e6a1624cb4553e499
class CacheNode extends Node {

	static get type() {

		return 'CacheNode';

	}

<<<<<<< HEAD
=======
	/**
	 * Constructs a new cache node.
	 *
	 * @param {Node} node - The node that should be cached.
	 * @param {boolean} [parent=true] - Whether this node refers to a shared parent cache or not.
	 */
>>>>>>> 50c6784a0819c7177d83555e6a1624cb4553e499
	constructor( node, parent = true ) {

		super();

<<<<<<< HEAD
		this.node = node;
		this.parent = parent;

=======
		/**
		 * The node that should be cached.
		 *
		 * @type {Node}
		 */
		this.node = node;

		/**
		 * Whether this node refers to a shared parent cache or not.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.parent = parent;

		/**
		 * This flag can be used for type testing.
		 *
		 * @type {boolean}
		 * @readonly
		 * @default true
		 */
>>>>>>> 50c6784a0819c7177d83555e6a1624cb4553e499
		this.isCacheNode = true;

	}

	getNodeType( builder ) {

<<<<<<< HEAD
		return this.node.getNodeType( builder );
=======
		const previousCache = builder.getCache();
		const cache = builder.getCacheFromNode( this, this.parent );

		builder.setCache( cache );

		const nodeType = this.node.getNodeType( builder );

		builder.setCache( previousCache );

		return nodeType;
>>>>>>> 50c6784a0819c7177d83555e6a1624cb4553e499

	}

	build( builder, ...params ) {

		const previousCache = builder.getCache();
		const cache = builder.getCacheFromNode( this, this.parent );

		builder.setCache( cache );

		const data = this.node.build( builder, ...params );

		builder.setCache( previousCache );

		return data;

	}

}

export default CacheNode;

<<<<<<< HEAD
export const cache = ( node, ...params ) => nodeObject( new CacheNode( nodeObject( node ), ...params ) );
=======
/**
 * TSL function for creating a cache node.
 *
 * @tsl
 * @function
 * @param {Node} node - The node that should be cached.
 * @param {boolean} [parent] - Whether this node refers to a shared parent cache or not.
 * @returns {CacheNode}
 */
export const cache = ( node, parent ) => nodeObject( new CacheNode( nodeObject( node ), parent ) );
>>>>>>> 50c6784a0819c7177d83555e6a1624cb4553e499

addMethodChaining( 'cache', cache );
